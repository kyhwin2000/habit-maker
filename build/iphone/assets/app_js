var osname=Ti.Platform.osname,version=Ti.Platform.version,scrHeight=Ti.Platform.displayCaps.platformHeight,scrWidth=Ti.Platform.displayCaps.platformWidth,defaultFontSize="android"===Ti.Platform.name?16:14,newHabit="",db=Ti.Database.open("habitDB");db.execute("CREATE TABLE IF NOT EXISTS habit (id INTEGER PRIMARY KEY, name TEXT, days TEXT, status TEXT)"),db.execute("DELETE FROM habit");var checkDB=function(){var e=Ti.Database.open("habitDB"),t=e.execute("SELECT * FROM habit");Ti.API.info("Row count: "+t.rowCount);var a;for(a="android"===Ti.Platform.name?t.fieldCount:t.fieldCount(),Ti.API.info("Field count: "+a);t.isValidRow();)Ti.API.info("habit ---> name: "+t.fieldByName("name")+", days: "+t.fieldByName("days")+", status: "+t.fieldByName("status")),t.next();e.close()},chk01Dates=["2013-1-17","2013-1-19","2013-1-20"],Json01String=JSON.stringify(chk01Dates),chk02Dates=["2013-2-2","2013-2-4","2013-2-10"],Json02String=JSON.stringify(chk02Dates),chk03Dates=[],Json03String=JSON.stringify(chk03Dates),habit01Array=["매일 운동",Json01String,"20%"];db.execute("INSERT INTO habit (name, days, status) VALUES (?, ?, ?)",habit01Array);var habit02Array=["매일 코딩",Json02String,"30%"];db.execute("INSERT INTO habit (name, days, status) VALUES (?, ?, ?)",habit02Array),db.close(),Ti.UI.setBackgroundColor("#000");var win1=Ti.UI.createWindow(),win2=Ti.UI.createWindow({title:"습관 목록",backgroundColor:"#fff"}),win3=Ti.UI.createWindow({url:"win3.js",title:"습관 달력",backgroundColor:"#fff"}),nav=Ti.UI.iPhone.createNavigationGroup({window:win2}),updateRow=function(){for(var e=Ti.Database.open("habitDB"),t=e.execute("SELECT * FROM habit"),a=[],i=0;t.isValidRow();){var n=Ti.UI.createTableViewRow({className:"habits",selectedBackgroundColor:"white",height:60}),o=Ti.UI.createLabel({color:"#576996",font:{fontFamily:"Arial",fontSize:defaultFontSize+6,fontWeight:"bold"},text:t.fieldByName("name"),rowID:i,left:20,top:20,width:200,height:30});n.add(o);var r=Ti.UI.createLabel({color:"#999",font:{fontFamily:"Arial",fontSize:defaultFontSize,fontWeight:"normal"},text:t.fieldByName("status"),left:260,top:20,width:200,height:30});n.add(r),a.push(n),t.next(),i++}t.close(),e.close();var d=Ti.UI.createTableView({backgroundColor:"white",top:50,data:a,editable:!0,moveable:!0});d.addEventListener("click",function(e){Ti.App.Properties.setInt("selectedRow",e.source.rowID),nav.open(win3,{animated:!0})}),d.addEventListener("delete",function(e){var t=Ti.Database.open("habitDB");t.execute("DELETE FROM habit WHERE id=?",e.index+1),checkDB(),t.close()}),win2.add(d)};updateRow();var tf1=Ti.UI.createTextField({color:"#336699",height:35,top:10,left:10,width:300,hintText:"Add an item",keyboardType:Ti.UI.KEYBOARD_DEFAULT,returnKeyType:Ti.UI.RETURNKEY_DEFAULT,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});tf1.addEventListener("change",function(e){newHabit=e.value}),tf1.addEventListener("return",function(){var e=Ti.Database.open("habitDB");e.execute("INSERT INTO habit (name,days,status) VALUES (?,?,?)",newHabit,Json03String,"0%"),e.close(),updateRow(),newHabit="",tf1.value="",tf1.blur()}),win2.add(tf1),win1.add(nav),win1.open(),win2.addEventListener("focus",function(){updateRow()});